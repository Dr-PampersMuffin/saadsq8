<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Viewer — SAAD $SQ8</title>
  <style>
    *{ box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      background: #f7f7f7;
      color: #111;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Top bar */
    .topbar {
      position: sticky; top: 0;
      display: flex; align-items: center; justify-content: space-between;
      gap: 12px;
      padding: 10px 14px;
      background: #222;
      color: #facc15;
      border-bottom: 2px solid #000;
      z-index: 10;
    }
    .group { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
    .title { font-weight: 900; letter-spacing: .3px; color: #facc15; }
    .btn {
      text-decoration: none;
      font-weight: 700;
      color: #111;
      padding: 6px 10px;
      border-radius: 8px;
      background: #fff3bd;
      border: 1px solid rgba(0,0,0,0.15);
      transition: transform .15s ease, box-shadow .15s ease, background .2s;
    }
    .btn:hover { transform: translateY(-1px); box-shadow: 0 6px 16px rgba(0,0,0,0.15); background:#fff; }

    /* Layout wrapper below topbar */
    main.viewer {
      flex: 1 1 auto;
      width: 100%;
      display: block;
      margin: 0;
      padding: 0;
    }

    /* ---------- IMAGE MODE (scroll the full tall image) ---------- */
    .image-stage {
      width: 100%;
      max-width: none;
      margin: 0;
      padding: 0;
      /* no fixed height here — allow page to scroll naturally */
      background: #fff;
    }
    .image-stage img {
      display: block;
      width: 100vw;   /* fill full viewport width */
      max-width: 100vw;
      height: auto;   /* natural height so you can scroll */
      margin: 0 auto;
      image-rendering: auto;
    }

    /* ---------- PDF MODE (full viewport iframe) ---------- */
    .pdf-stage {
      width: 100%;
      height: calc(100vh - 52px); /* viewport minus topbar (approx) */
      background: #fff;
    }
    .pdf-stage iframe {
      width: 100%;
      height: 100%;
      border: 0;
      display: block;
      background: #fff;
    }

    /* Small screens */
    @media (max-width: 480px){
      .btn { font-size: 14px; }
      .pdf-stage { height: calc(100vh - 54px); }
    }
  </style>
</head>
<body>
  <div class="topbar">
    <div class="group">
      <a class="btn" href="index.html">← Home</a>
      <span class="title" id="docTitle">Viewer</span>
    </div>
    <div class="group">
      <a class="btn" id="downloadBtn" href="#" target="_blank" rel="noopener">Download</a>
    </div>
  </div>

  <main class="viewer" id="viewerRoot">
    <!-- Filled by script with image or pdf stage -->
  </main>

  <script>
    (function () {
      const p = new URLSearchParams(location.search);
      const fileParam = p.get('file') || '';  // e.g. assets/Whitepaper.png
      const title = p.get('title') || 'Viewer';

      // Only allow relative paths (no http/https)
      const isRelative = (s) => !!s && !/^(https?:)?\/\//i.test(s);

      document.title = `${title} — SAAD $SQ8`;
      document.getElementById('docTitle').textContent = title;

      const root = document.getElementById('viewerRoot');
      const dl = document.getElementById('downloadBtn');

      if (!isRelative(fileParam)) {
        root.innerHTML =
          '<div style="padding:20px;text-align:center;max-width:40ch;margin:20px auto;background:#fff;border-radius:12px;border:1px solid rgba(0,0,0,0.1)">' +
          'No file specified or unsupported URL. Use ' +
          '<code>?file=assets/Whitepaper.png&amp;title=Whitepaper</code>.' +
          '</div>';
        dl.style.display = 'none';
        return;
      }

      // set download
      dl.href = fileParam;
      dl.download = '';

      // Detect type by extension
      const lower = fileParam.toLowerCase();
      const isImage = /\.(png|jpe?g|webp|gif|svg)$/.test(lower);
      const isPdf   = /\.pdf$/.test(lower);

      if (isImage) {
        const stage = document.createElement('div');
        stage.className = 'image-stage';

        const img = document.createElement('img');
        img.alt = title;
        img.src = fileParam;

        // Optional: guard against loading failure
        img.onerror = () => {
          stage.innerHTML =
            '<div style="padding:20px;text-align:center;max-width:40ch;margin:20px auto;">' +
            'Failed to load image. Check the path and filename casing.' +
            '</div>';
        };

        stage.appendChild(img);
        root.replaceChildren(stage);
      } else if (isPdf) {
        const stage = document.createElement('div');
        stage.className = 'pdf-stage';

        const iframe = document.createElement('iframe');
        iframe.title = 'Document';
        iframe.src = `${fileParam}#toolbar=1&navpanes=0&view=FitH`;

        stage.appendChild(iframe);
        root.replaceChildren(stage);
      } else {
        root.innerHTML =
          '<div style="padding:20px;text-align:center;max-width:40ch;margin:20px auto;background:#fff;border-radius:12px;border:1px solid rgba(0,0,0,0.1)">' +
          'Unsupported file type. Please use PNG/JPG/WEBP/SVG or PDF.' +
          '</div>';
        dl.style.display = 'none';
      }
    })();
  </script>
</body>
</html>
